# Transactional System Core ‚Äî —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ

**–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–µ —è–¥—Ä–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç double spending, –∞—Ç–æ–º–∞—Ä–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π 10 % –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ Celery + Redis.

## –°—Ç–µ–∫
- Python 3.11+
- Django 4.2+ + DRF
- PostgreSQL
- Celery 5.3 + Redis (broker & backend)
- Windows 10/11 (–ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)


# üßë‚Äçüíª –¢–ï–°–¢–û–í–û–ï –ó–ê–î–ê–ù–ò–ï: "Transactional System Core"

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 2‚Äì3 —á–∞—Å–∞. **–°—Ç–µ–∫:** Python, Django, DRF, Celery (Redis), PostgreSQL.

## –õ–µ–≥–µ–Ω–¥–∞

–ú—ã –ø–∏—à–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –¥–ª—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤ –∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–µ —è–¥—Ä–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**.

---

## üöÄ –ó–∞–¥–∞—á–∞ 1: API –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å `Wallet` (–ö–æ—à–µ–ª–µ–∫) –∏ `Transaction` (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è). –°–¥–µ–ª–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/transfer`, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤–∞–ª—é—Ç—É —Å –∫–æ—à–µ–ª—å–∫–∞ –ê –Ω–∞ –∫–æ—à–µ–ª–µ–∫ –ë.

### –£—Å–ª–æ–≤–∏—è —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–æ–π:

* **Race Condition Check:** –ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –Ω–∞ —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –æ—Ç –æ–¥–Ω–æ–≥–æ —é–∑–µ—Ä–∞ —Å —Ü–µ–ª—å—é —Å–ø–∏—Å–∞—Ç—å –±–∞–ª–∞–Ω—Å –≤ –º–∏–Ω—É—Å. –†–µ–∞–ª–∏–∑—É–π –∑–∞—â–∏—Ç—É –æ—Ç **Double Spending** (–¥–≤–æ–π–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è). –ü–æ–¥—Å–∫–∞–∑–∫–∞: –ü—Ä–æ—Å—Ç–æ `if balance > amount` –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.
* **–ö–æ–º–∏—Å—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** –ï—Å–ª–∏ —Å—É–º–º–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ $> 1000$ u., —Å–∏—Å—Ç–µ–º–∞ –±–µ—Ä–µ—Ç –∫–æ–º–∏—Å—Å–∏—é 10%. –ö–æ–º–∏—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞—á–∏—Å–ª—è—Ç—å—Å—è –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ—à–µ–ª–µ–∫ `admin`. –í—Å–µ —Ç—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–ø–∏—Å–∞–Ω–∏–µ, –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ, –∫–æ–º–∏—Å—Å–∏—è) –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ **–∞—Ç–æ–º–∞—Ä–Ω–æ** (–ª–∏–±–æ –≤—Å–µ, –ª–∏–±–æ –Ω–∏—á–µ–≥–æ).

---

## ‚ö° –ó–∞–¥–∞—á–∞ 2: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å "—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ" –ø–æ–ª—É—á–∞—Ç–µ–ª—é (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ Telegram, –Ω–æ —Ç—É—Ç —É–ø—Ä–æ—Å—Ç–∏–º).

* –°–æ–∑–¥–∞–π –∑–∞–¥–∞—á—É –≤ **Celery**.
* –í–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞—á–∏ —Å–¥–µ–ª–∞–π –∏–º–∏—Ç–∞—Ü–∏—é –¥–æ–ª–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (`time.sleep(5)`).
* **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ "–æ—Ç–ø—Ä–∞–≤–∫–∞" —É–ø–∞–ª–∞ (—Å–∏–º—É–ª—è—Ü–∏—è –æ—à–∏–±–∫–∏), –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è (**Retry**) —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 3-—Ö —Ä–∞–∑.

---

## üìπ –ó–∞–¥–∞—á–∞ 3: –í–∏–¥–µ–æ-–∑–∞—â–∏—Ç–∞ (Screencast)

–ó–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ (3-5 –º–∏–Ω—É—Ç) —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π —ç–∫—Ä–∞–Ω–∞ –∏ –≥–æ–ª–æ—Å–æ–º. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –≤ –≤–∏–¥–µ–æ:

1.  –ü–æ–∫–∞–∂–∏ –∫–æ–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –æ–±—ä—è—Å–Ω–∏, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Ç—ã –∑–∞—â–∏—Ç–∏–ª—Å—è –æ—Ç **Race Condition** (–ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `transaction.atomic`, `select_for_update` –∏–ª–∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É).
2.  –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç (–∏–ª–∏ `curl`), –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å–ø–∏—Å–∞–Ω–∏–µ, –∏ –ø–æ–∫–∞–∂–∏, —á—Ç–æ –±–∞–ª–∞–Ω—Å –Ω–µ —É—à–µ–ª –≤ –º–∏–Ω—É—Å.

***

–ú–æ–≥—É –ª–∏ —è –ø–æ–º–æ—á—å –≤–∞–º —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Django/Vue.js –∏–ª–∏ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –æ–¥–Ω–æ–≥–æ –∏–∑ —ç—Ç–∏—Ö –ø—É–Ω–∫—Ç–æ–≤?

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ |
|------------|------------------|----------------|
| POST /api/transfer | `TransferAPIView` –≤ `transactions/api/views.py` | –†–∞–±–æ—Ç–∞–µ—Ç |
| –ó–∞—â–∏—Ç–∞ –æ—Ç double spending –ø—Ä–∏ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö | `select_for_update()` + `@transaction.atomic` –Ω–∞ —Ç—Ä—ë—Ö –∫–æ—à–µ–ª—å–∫–∞—Ö | –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –±–∞–ª–∞–Ω—Å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Ö–æ–¥–∏—Ç –≤ –º–∏–Ω—É—Å |
| –ö–æ–º–∏—Å—Å–∏—è 10 % –ø—Ä–∏ —Å—É–º–º–µ > 1000 | –°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–≤–µ—Ä—Ö —Å—É–º–º—ã, –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ—à–µ–ª—ë–∫ `admin` | –ê—Ç–æ–º–∞—Ä–Ω–æ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | Celery-–∑–∞–¥–∞—á–∞ `send_notification_task` | –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `.delay()` |
| Retry –¥–æ 3 —Ä–∞–∑ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 3 —Å–µ–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ | `max_retries=3`, `default_retry_delay=3`, `self.retry(countdown=3)` | –í–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö Celery |
| –ò–º–∏—Ç–∞—Ü–∏—è –¥–æ–ª–≥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ | `time.sleep()` (–≤ –ø—Ä–æ–¥–µ –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Telegram) | –ï—Å—Ç—å |

## –û—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

| –§–∏—á–∞ | –ó–∞—á–µ–º |
|------|------|
| `select_for_update()` –Ω–∞ —Ç—Ä—ë—Ö –∫–æ—à–µ–ª—å–∫–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | 100 % –∑–∞—â–∏—Ç–∞ –¥–∞–∂–µ –ø—Ä–∏ —Ç—ã—Å—è—á–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| –ß–∏—Å—Ç—ã–µ –∏–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü (`wallets`, `transactions`) | –£–¥–æ–±–Ω–æ –≤ pgAdmin –∏ raw SQL |
| –ò–Ω–¥–µ–∫—Å –ø–æ `timestamp` | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∏–ª–ª–∏–æ–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| `MinValueValidator(0.00)` –Ω–∞ –±–∞–ª–∞–Ω—Å | –§–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å |
| `list_editable = ('balance',)` –≤ –∞–¥–º–∏–Ω–∫–µ | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä—è–º–æ –≤ —Å–ø–∏—Å–∫–µ |
| Data migration —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ + `reverse_code` | –û–¥–∏–Ω `migrate` ‚Äî –≤—Å—ë –≥–æ—Ç–æ–≤–æ |
| –ü–æ–¥—Ä–æ–±–Ω—ã–π —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç `stress_test.py` | 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º |

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å (Windows 10/11)

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º –∏ –∑–∞—Ö–æ–¥–∏–º
git clone https://github.com/iurij-n/Test_ft.git
cd transactional-system-core

# 2. –°–æ–∑–¥–∞—ë–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º venv
python -m venv venv
venv\Scripts\activate

# 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
# (–∏–ª–∏ –≤—Ä—É—á–Ω—É—é: django djangorestframework psycopg2-binary celery[redis] redis python-dotenv)

# 4. –°–æ–∑–¥–∞—ë–º –±–∞–∑—É PostgreSQL "transactional_system" (—á–µ—Ä–µ–∑ pgAdmin –∏–ª–∏ psql)

# 5. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–¥—É—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∫–æ—à–µ–ª—å–∫–∏)
python manage.py migrate

# 6. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç—Ä–∏ –æ–∫–Ω–∞:
# –û–∫–Ω–æ 1 Django
python manage.py runserver

# –û–∫–Ω–æ 2 Celery
celery -A core.celery worker -l info --pool=solo

# –û–∫–Ω–æ 3 ‚Äî —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç
python stress_test.py
